# 功能特性详解

## 📊 胎动记录功能

### 实时计数模式

**核心组件**: `MovementCounter.tsx`

#### 功能说明
- 大号圆形按钮（200x200px），符合多邻国风格
- 每次点击记录一次胎动，提供震动反馈
- 实时显示计时器，记录完成10次胎动所需时间
- 达到10次时显示庆祝动画和鼓励文案

#### 使用流程
1. 点击"开始数胎动"进入计数模式
2. 每感受到胎动，点击中央大按钮
3. 系统自动记录时间戳和次数
4. 完成10次或手动结束后保存会话

#### 数据结构
```typescript
interface MovementSession {
  id: string;              // 会话ID
  date: Date;             // 日期
  startTime: Date;        // 开始时间
  endTime?: Date;         // 结束时间
  count: number;          // 胎动次数
  duration?: number;      // 持续时长（分钟）
  completed: boolean;     // 是否完成（≥10次）
}
```

### 日历视图模式

**核心组件**: `MovementCalendar.tsx`

#### 功能说明
- 月历展示，直观查看每天的胎动记录
- 颜色编码快速识别胎动状况
- 点击日期查看当天详细记录
- 月度统计数据汇总

#### 颜色标识
| 颜色 | 次数范围 | 状态 | 说明 |
|-----|---------|------|------|
| 🟢 绿色 | ≥10次 | 正常 | 符合正常标准 |
| 🟡 黄色 | 5-9次 | 偏少 | 需注意观察 |
| 🟠 橙色 | 1-4次 | 较少 | 建议增加记录 |
| ⚪ 灰色 | 0次 | 无记录 | 未记录 |

#### 统计功能
- **记录天数**: 本月有记录的天数
- **总次数**: 本月所有胎动总计
- **正常天数**: 达到≥10次的天数

#### 详情面板
点击有记录的日期，显示：
- 日期和星期
- 当天总胎动次数和状态
- 所有计数会话列表
- 每个会话的开始/结束时间和用时

### 列表视图模式

**核心组件**: `MovementHistory.tsx`

#### 功能说明
- 时间倒序显示最近20条会话
- 每条会话显示：日期、时间、次数、时长
- 完成状态标识
- 空状态提示

---

## 🏥 产检提醒功能

### 双重通知系统

**核心文件**: `lib/notifications.ts`, `CheckupList.tsx`

#### 1. 浏览器系统通知（优先）

**特点**：
- 即使应用未打开也能收到
- 使用系统原生通知UI
- 需要用户明确授权

**实现**：
```typescript
// 请求权限
const permission = await Notification.requestPermission();

// 显示通知
new Notification('产检提醒', {
  body: '唐氏筛查在3小时后',
  icon: '/icons/icon-192x192.png',
  tag: 'checkup-123',
  requireInteraction: true
});
```

**限制**：
- 用户可能拒绝授权
- iOS Safari 支持有限
- 需要HTTPS环境

#### 2. 应用内Toast提醒（降级方案）

**特点**：
- 无需权限，100%可靠
- 打开应用时自动检查
- 醒目的横幅提示

**实现**：
- 每次打开应用检查24小时内的产检
- 显示提醒数量和最近一次产检信息
- 点击可直接跳转到产检详情

#### 权限请求流程

```
用户添加产检并开启提醒
    ↓
检查Notification权限
    ↓
├─ granted → 使用浏览器通知
├─ default → 友好地请求权限
│      ↓
│   ├─ 用户同意 → 使用浏览器通知
│   └─ 用户拒绝 → 切换到应用内提醒
└─ denied → 直接使用应用内提醒
```

### 产检管理

**核心组件**: `CheckupList.tsx`, `CheckupForm.tsx`, `CheckupCard.tsx`

#### 产检类型预设
- 初查
- NT检查（11-13周）
- 唐氏筛查（15-20周）
- 大排畸（20-24周）
- 糖耐量测试（24-28周）
- 常规产检
- 其他（自定义）

#### 提醒时间设置
默认三个时间点：
- 提前1天（1440分钟）
- 提前3小时（180分钟）
- 提前30分钟

可自定义开启/关闭提醒。

#### 产检卡片信息
- 产检类型徽章
- 日期和时间
- 地点（可选）
- 备注（可选）
- 状态标识：待产检/已完成/已过期
- 提醒状态

#### 操作功能
- ✓ 标记完成/取消完成
- ✎ 编辑产检信息
- 🗑 删除产检记录

---

## ⏰ 预产期倒计时功能

### 主倒计时显示

**核心组件**: `DueDateCounter.tsx`

#### 显示内容
1. **剩余天数**
   - 大号数字显示
   - 倒计时天数

2. **圆形进度环**
   - SVG绘制
   - 0-280天可视化
   - 百分比显示

3. **当前孕周**
   - 精确到周和天
   - 格式：X周Y天

4. **孕期阶段标识**
   - 孕早期（<14周）- 蓝色
   - 孕中期（14-27周）- 绿色
   - 孕晚期（≥28周）- 橙色

5. **宝宝大小对比**
   - Emoji图标
   - 对应物品名称
   - 参考长度（cm）

#### 宝宝大小数据

每周对应不同的水果/物品：
- 4周：罂粟籽 🌱
- 8周：覆盆子 🍒
- 12周：西梅 🌰
- 16周：鳄梨 🥑
- 20周：香蕉 🍌
- 24周：玉米 🌽
- 28周：茄子 🍆
- 32周：菠萝 🍍
- 36周：木瓜 🥭
- 40周：大南瓜 🎃

### 孕期里程碑

**核心组件**: `WeekProgress.tsx`

#### 时间轴展示
- 12周：第一次产检
- 20周：大排畸
- 28周：孕晚期开始
- 37周：足月
- 40周：预产期

#### 状态标识
- ✓ 已完成：绿色圆点，绿色文字
- ⚪ 进行中：白底绿边，高亮文字
- ⚪ 未到达：灰色圆点，灰色文字

### 初次引导

**核心组件**: `OnboardingWizard.tsx`

#### 引导流程
1. 欢迎页面（👶图标）
2. 输入昵称（可选）
3. 选择预产期（必填）
4. 提示：可使用末次月经+280天
5. 点击"开始使用"完成设置

#### 数据计算
```typescript
// 自动计算孕期开始日期
pregnancyStartDate = dueDate - 280天

// 实时计算当前孕周
weeks = (today - pregnancyStartDate) / 7天
```

---

## ⚙️ 设置和数据管理

### 个人信息管理

**核心组件**: `Settings.tsx`

#### 可编辑字段
- 昵称（可选）
- 预产期（必填）

编辑后自动重新计算：
- 孕期开始日期
- 当前孕周
- 剩余天数
- 宝宝大小

### 数据管理功能

#### 1. 导出数据
格式：JSON
内容包含：
- 用户资料
- 所有胎动会话
- 所有产检记录
- 导出时间戳

文件名：`baby-data-{timestamp}.json`

用途：
- 备份重要数据
- 分享给医生
- 迁移到其他设备

#### 2. 重置所有数据
操作流程：
1. 点击"重置所有数据"
2. 二次确认弹窗
3. 清除IndexedDB所有表
4. 清除LocalStorage
5. 刷新页面回到引导页

⚠️ 警告：此操作不可恢复

### 关于信息
- 应用版本号
- 数据隐私说明
- 免责声明
- 医疗建议提示

---

## 📱 PWA功能

### 安装提示

**核心组件**: `InstallPrompt.tsx`
**Hook**: `useInstallPrompt.ts`

#### 触发条件
- PWA可安装（浏览器检测）
- 尚未安装
- 用户未关闭提示

#### 提示内容
- 顶部横幅
- 绿色渐变背景
- 说明文字："离线使用，更快速的访问"
- 两个按钮：暂不 / 安装

#### 安装后效果
- 添加到主屏幕
- 独立窗口运行
- 隐藏浏览器UI
- 显示自定义图标和启动画面

### 离线功能

#### Service Worker策略

**静态资源**（Cache-First）：
- HTML, CSS, JS
- 图标、图片
- 字体文件

**优势**：极快的加载速度

**动态数据**（Network-First）：
- 如有API调用
- 离线时使用缓存

#### 数据持久化

**IndexedDB**（Dexie.js）：
- 胎动记录
- 产检记录
- 结构化数据

**LocalStorage**：
- 用户资料
- 预产期
- 简单配置

#### 离线体验
- ✅ 完整功能可用
- ✅ 数据实时保存
- ✅ 无需网络连接
- ✅ 数据永久保存

---

## 🎨 UI/UX设计

### 多邻国风格

#### 色彩系统
```css
--primary: #58CC02       /* 活力绿 */
--secondary: #FF9600     /* 橙色 */
--accent: #1CB0F6        /* 蓝色 */
--warning: #FFC800       /* 黄色 */
--error: #FF4B4B         /* 红色 */
```

#### 设计原则

1. **圆润可爱**
   - 所有元素大圆角（12-24px）
   - 柔和的边框
   - 友好的视觉感受

2. **高对比度**
   - 鲜艳的背景色
   - 清晰的文字
   - 深色边框强调

3. **大号触摸**
   - 主按钮≥60x60px
   - 胎动按钮200x200px
   - 适合移动设备

4. **轻快动画**
   - 按钮按下效果
   - 数字弹跳
   - 页面过渡
   - 庆祝动效

5. **鼓励性文案**
   - "太棒了！"
   - "宝宝很活跃呢~"
   - "完成今天的计数"

### 响应式设计

- 移动优先
- 最大宽度限制（max-w-2xl）
- 底部导航固定
- 安全区域适配（iOS刘海）

### 无障碍支持

- 语义化HTML
- ARIA标签
- 键盘导航
- 对比度≥4.5:1

---

## 🔔 通知最佳实践

### 何时请求权限

❌ 不好的做法：
- 应用启动立即请求
- 没有任何上下文

✅ 好的做法：
- 用户添加第一个产检时
- 显示友好的说明弹窗
- 解释通知的价值
- 提供"仅应用内提醒"选项

### 权限被拒后

- 不再重复请求
- 自动切换到应用内提醒
- 在设置页提示可重新授权

### 通知内容设计

**标题**：简短明确
```
产检提醒
```

**正文**：关键信息
```
唐氏筛查在3小时后
地点：市妇幼保健院
```

**行为**：
- 点击通知打开应用
- 直接跳转到产检详情

---

## 📊 数据统计（未来扩展）

### 可能的统计功能

1. **胎动趋势图**
   - 折线图展示每周平均
   - 最活跃时段分析

2. **完成率统计**
   - 达标天数占比
   - 连续记录天数

3. **产检履历**
   - 完成的产检数量
   - 产检类型分布

4. **导出报告**
   - PDF格式
   - 可打印分享给医生

---

## 🚀 性能优化

### 已实现的优化

1. **代码分割**
   - Vite自动按路由分割
   - 懒加载组件

2. **资源优化**
   - SVG图标
   - 轻量级依赖

3. **缓存策略**
   - Service Worker
   - 静态资源长期缓存

4. **Bundle大小**
   - Preact（3KB）vs React（40KB）
   - Tree-shaking去除未使用代码

### 性能目标

- First Contentful Paint < 1.5s
- Time to Interactive < 3s
- Lighthouse Score ≥ 90
- Total Bundle < 100KB (gzipped)

---

需要更多功能？欢迎提 Issue 或 PR！
